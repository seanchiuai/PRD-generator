# Error: Schema Mismatch for Tech Stack Selection

**Date Found**: 2025-11-16
**Severity**: Critical
**Stage**: Selection
**Component**: Convex Database Schema - conversations table

## Description

When selecting tech stack options for "real-time-communication" and "file-storage", the application throws a Convex schema validation error because these fields are not defined in the selectedTechStack validator.

## Error Message

```
[CONVEX M(conversations:saveSelection)] [Request ID: dc37c6eba0cd4e7a] Server Error
Uncaught Error: Failed to insert or update a document in table "conversations" because it does not match the schema: Object contains extra field `real-time-communication` that is not in the validator.
Path: .selectedTechStack
```

## Current Validator Schema

```javascript
v.object({
  additionalTools: v.optional(v.array(v.object({category: v.string(), name: v.string(), reasoning: v.string()}))),
  authentication: v.optional(v.object({name: v.string(), reasoning: v.string(), selectedFrom: v.array(v.string())})),
  backend: v.optional(v.object({name: v.string(), reasoning: v.string(), selectedFrom: v.array(v.string())})),
  database: v.optional(v.object({name: v.string(), reasoning: v.string(), selectedFrom: v.array(v.string())})),
  frontend: v.optional(v.object({name: v.string(), reasoning: v.string(), selectedFrom: v.array(v.string())})),
  hosting: v.optional(v.object({name: v.string(), reasoning: v.string(), selectedFrom: v.array(v.string())}))
})
```

## Missing Fields

The research generates 7 categories, but the schema only supports 6:

**Included in Schema:**
- ✅ frontend
- ✅ backend
- ✅ database
- ✅ authentication
- ✅ hosting (maps to "hosting-deployment")

**Missing from Schema:**
- ❌ real-time-communication (causes immediate error)
- ❌ file-storage (causes immediate error)

## Expected Behavior

All 7 tech stack categories generated by research should be saveable to the database.

## Actual Behavior

Selecting "real-time-communication" or "file-storage" throws a schema validation error and prevents saving. The selection appears to work in the UI (shows "X of 7 selected") but fails silently in the background.

## Steps to Reproduce

1. Complete workflow through Research stage
2. Navigate to Selection stage
3. Select: Frontend, Backend, Database, Authentication
4. Select: Real-time communication
5. Check browser console for errors
6. Observe error: "Object contains extra field `real-time-communication`"

## Impact

- **Critical**: Users cannot select all tech stack options
- Blocks workflow progression for projects requiring real-time communication or file storage
- Silent failure - UI shows selection succeeded but data not saved
- When user tries to generate PRD, only 4/7 selections are saved, causing validation failure

## Location

File: `convex/conversations.ts` (saveSelection mutation at line 319)
Schema: Likely in `convex/schema.ts` or schema definition file

## Fix Required

Update the Convex schema to include all 7 categories:

```javascript
v.object({
  additionalTools: v.optional(v.array(v.object({category: v.string(), name: v.string(), reasoning: v.string()}))),
  authentication: v.optional(v.object({name: v.string(), reasoning: v.string(), selectedFrom: v.array(v.string())})),
  backend: v.optional(v.object({name: v.string(), reasoning: v.string(), selectedFrom: v.array(v.string())})),
  database: v.optional(v.object({name: v.string(), reasoning: v.string(), selectedFrom: v.array(v.string())})),
  frontend: v.optional(v.object({name: v.string(), reasoning: v.string(), selectedFrom: v.array(v.string())})),
  hosting: v.optional(v.object({name: v.string(), reasoning: v.string(), selectedFrom: v.array(v.string())})),
  "real-time-communication": v.optional(v.object({name: v.string(), reasoning: v.string(), selectedFrom: v.array(v.string())})),
  "file-storage": v.optional(v.object({name: v.string(), reasoning: v.string(), selectedFrom: v.array(v.string())}))
})
```

Or use a more flexible schema with `v.record()` to allow dynamic category names.

## Related Errors

This is the root cause for:
- generate-validation-failed.md (cascading effect)
